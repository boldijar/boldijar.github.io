<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Story reader</title>
  <style>
    * { box-sizing: border-box; }
    body { font-family: system-ui, sans-serif; max-width: 42rem; margin: 0 auto; padding: 1rem 1.5rem; padding-top: 3rem; line-height: 1.6; color: #1a1a1a; }
    .dark-toggle { position: fixed; top: 1rem; right: 1rem; width: 2.5rem; height: 2.5rem; padding: 0; border: none; border-radius: 50%; background: #e0e0e0; color: #333; cursor: pointer; display: flex; align-items: center; justify-content: center; z-index: 10; }
    .dark-toggle:hover { background: #ccc; }
    body.dark .dark-toggle { background: #333; color: #e0e0e0; }
    body.dark .dark-toggle:hover { background: #555; }
    header { display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 1rem; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid #e0e0e0; }
    h1 { margin: 0; font-size: 1.5rem; }
    .meta { font-size: 0.9rem; color: #555; }
    .tags { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.5rem; }
    .tag { background: #f0f0f0; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.85rem; }
    .tag strong { display: block; }
    .switch-row { display: flex; align-items: center; gap: 0.5rem; }
    .switch-row label { cursor: pointer; user-select: none; }
    .content { margin: 1rem 0; }
    .sentence-block { margin-bottom: 0.5rem; }
    .sentence-block.show-translation { margin-bottom: 1rem; }
    .sentence-block.show-translation .translation { display: block; }
    .sentence-block .translation { display: none; margin-top: 0.25rem; padding-left: 1rem; font-size: 0.95rem; color: #555; border-left: 3px solid #ccc; }
    .sentence-block .text .hl { background: #fff3cd; padding: 0 2px; border-radius: 2px; }
    .content img { max-width: 100%; height: auto; display: block; margin: 1rem 0; border-radius: 8px; }
    .content img.hide { display: none !important; }
    .glossary { margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid #e0e0e0; }
    .glossary h2 { font-size: 1.1rem; margin-bottom: 0.75rem; }
    .glossary dl { margin: 0; }
    .glossary dt { font-weight: 600; margin-top: 0.75rem; }
    .glossary dt:first-child { margin-top: 0; }
    .glossary dd { margin: 0.25rem 0 0 0; color: #444; font-size: 0.95rem; }
    body.dark { background: #1a1a1a; color: #e0e0e0; }
    body.dark header { border-bottom-color: #404040; }
    body.dark .meta { color: #aaa; }
    body.dark .tag { background: #2d2d2d; color: #ccc; }
    body.dark .sentence-block .translation { color: #aaa; border-left-color: #555; }
    body.dark .sentence-block .text .hl { background: #4a3f1a; color: #f0e6c8; }
    body.dark .glossary { border-top-color: #404040; }
    body.dark .glossary h2, body.dark .glossary dt { color: #e8e8e8; }
    body.dark .glossary dd { color: #aaa; }
    body.dark .content img:not(.hide) { filter: invert(1); }
    .back { margin-bottom: 1rem; }
    .back a { color: #666; text-decoration: none; font-size: 0.9rem; }
    .back a:hover { text-decoration: underline; }
    body.dark .back a { color: #aaa; }
    .error { color: #c00; padding: 2rem; }
  </style>
</head>
<body>
  <button type="button" class="dark-toggle" id="darkToggle" title="Toggle dark mode" aria-label="Toggle dark mode">
    <svg id="iconSun" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="4"/><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></svg>
    <svg id="iconMoon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
  </button>
  <div class="back"><a href="index.html">← All stories</a></div>
  <header>
    <div><h1 id="title"></h1><p class="meta" id="meta"></p><div class="tags" id="tags"></div></div>
    <div class="switch-row">
      <input type="checkbox" id="showTranslations" />
      <label for="showTranslations">Show translations under sentences</label>
    </div>
  </header>
  <main class="content" id="content"></main>
  <footer class="glossary" id="glossary"></footer>
  <script>var EMBEDDED_STORIES = {"apres_ski_pastel": {"title": "El après-ski y el pastelito", "titleTranslation": "The après-ski and the little pastry", "level": "A2", "language": "es", "thumbnail": {"filename": "apres_ski_pastel_thumbnail_snow_mountains.png", "generation_prompt": "Snowy mountains in Romania, snowboarder in the distance, winter sun, peaceful ski resort."}, "tags": [{"name": "Grammar", "description": "Past tense (pretérito indefinido, imperfecto), simple connectors, expressing likes and decisions"}, {"name": "Vocabulary", "description": "Snow, mountains, directions, food, places"}, {"name": "Themes", "description": "Snowboarding, après-ski, finding your way, making memories"}], "content": [{"type": "sentence", "text": "Una vez fui a hacer snowboard a las montañas de Rumanía.", "translation": "Once I went snowboarding in the mountains of Romania."}, {"type": "sentence", "text": "Sabía que hay un après-ski en medio de la pista con pastelitos.", "translation": "I knew there is an après-ski in the middle of the slope with little pastries.", "highlights": [{"startIndex": 17, "endIndex": 26, "text": "après-ski", "glossaryKey": "après-ski"}, {"startIndex": 52, "endIndex": 62, "text": "pastelitos", "glossaryKey": "pastelitos"}]}, {"type": "sentence", "text": "No sabíamos cómo llegar pero al final alguien nos dijo el camino.", "translation": "We didn't know how to get there but in the end someone told us the way."}, {"type": "image", "filename": "apres_ski_pastel_mountains_slope.png", "generation_prompt": "Snowboarder looking at a mountain slope in Romanian mountains, winter, looking for the way, snow and trees."}, {"type": "sentence", "text": "Encontramos el lugar y bajamos por esa pista.", "translation": "We found the place and went down that slope."}, {"type": "sentence", "text": "En una parte la pista era muy empinada y corta.", "translation": "In one part the slope was very steep and short.", "highlights": [{"startIndex": 30, "endIndex": 38, "text": "empinada", "glossaryKey": "empinada"}]}, {"type": "sentence", "text": "Después a la derecha la pista iba más lento y no daba miedo.", "translation": "Then to the right the slope went slower and it wasn't scary.", "highlights": [{"startIndex": 49, "endIndex": 59, "text": "daba miedo", "glossaryKey": "daba miedo"}]}, {"type": "image", "filename": "apres_ski_pastel_steep_section.png", "generation_prompt": "Steep short section of a ski slope then easing to the right, snow, winter, dynamic but not scary."}, {"type": "sentence", "text": "¡Era genial!", "translation": "It was great!"}, {"type": "sentence", "text": "Llegamos al après-ski pero ya no tenían pastelitos.", "translation": "We arrived at the après-ski but they didn't have little pastries anymore."}, {"type": "sentence", "text": "Decidimos que ese trozo de pista era nuestro pastelito.", "translation": "We decided that that bit of slope was our little pastry.", "highlights": [{"startIndex": 18, "endIndex": 23, "text": "trozo", "glossaryKey": "trozo"}, {"startIndex": 45, "endIndex": 54, "text": "pastelito", "glossaryKey": "pastelito"}]}, {"type": "image", "filename": "apres_ski_pastel_bar_arrival.png", "generation_prompt": "Arriving at a cozy après-ski bar in the mountains, no pastries left, friends laughing, winter atmosphere."}, {"type": "sentence", "text": "Desde entonces \"ir a por un pastelito\" significa bajar por esa pista.", "translation": "Since then \"going for a little pastry\" means going down that slope.", "highlights": [{"startIndex": 39, "endIndex": 48, "text": "significa", "glossaryKey": "significa"}]}, {"type": "sentence", "text": "Ese recorrido es nuestro pastelito favorito.", "translation": "That run is our favourite little pastry."}, {"type": "sentence", "text": "La montaña nos dio algo mejor que un dulce.", "translation": "The mountain gave us something better than a sweet.", "highlights": [{"startIndex": 37, "endIndex": 42, "text": "dulce", "glossaryKey": "dulce"}]}], "glossary": {"après-ski": {"translation": "après-ski (after-ski)", "explanation": "Loan word: the bar or place where you go after skiing. Same in English."}, "pastelitos": {"translation": "little pastries, small cakes", "explanation": "Plural of 'pastelito'. Diminutive of pastel; common word for small sweet baked goods."}, "empinada": {"translation": "steep", "explanation": "Adjective (feminine). 'Una pista empinada' = a steep slope. Masculine: empinado."}, "daba miedo": {"translation": "was scary, gave (us) fear", "explanation": "Dar miedo = to be scary. 'No daba miedo' = it wasn't scary. Literally 'it didn't give fear'."}, "trozo": {"translation": "piece, bit", "explanation": "Noun (masculine). Un trozo de = a piece of. Un trozo de pista = a section of slope."}, "pastelito": {"translation": "little pastry, small cake", "explanation": "Noun (masculine). Diminutive of pastel (-ito). Here used in a fun way: the 'little pastry' is the nice run."}, "significa": {"translation": "means", "explanation": "From the verb significar (to mean). 'X significa Y' = X means Y."}, "dulce": {"translation": "sweet, candy", "explanation": "Noun (masculine). Un dulce = a sweet. Also adjective: sweet (taste)."}}}, "bali_scooter": {"title": "El surfista y la scooter en Bali", "titleTranslation": "The surfer and the scooter in Bali", "level": "B1", "language": "es", "thumbnail": {"filename": "bali_scooter_thumbnail_surfer_beach.png", "generation_prompt": "A surfer with a board walking on a tropical beach at sunset, Bali style, warm colors, peaceful mood."}, "tags": [{"name": "Grammar", "description": "Past tense (pretérito indefinido and imperfecto), expressing surprise and discovery"}, {"name": "Vocabulary", "description": "Travel, transport, directions, daily routines"}, {"name": "Themes", "description": "Travel mishaps, cultural differences, driving rules"}], "content": [{"type": "sentence", "text": "Hace un año fui a Bali para surfear.", "translation": "A year ago I went to Bali to surf."}, {"type": "sentence", "text": "Necesitaba un medio de transporte para moverme por la isla.", "translation": "I needed a means of transport to get around the island.", "highlights": [{"startIndex": 14, "endIndex": 33, "text": "medio de transporte", "glossaryKey": "medio de transporte"}]}, {"type": "image", "filename": "bali_scooter_rental_shop.png", "generation_prompt": "Small rental shop in Bali with scooters parked in front, tropical plants, sign in Spanish and English, sunny day."}, {"type": "sentence", "text": "Alquilé una scooter cerca de la playa.", "translation": "I rented a scooter near the beach.", "highlights": [{"startIndex": 0, "endIndex": 7, "text": "Alquilé", "glossaryKey": "alquilar"}]}, {"type": "sentence", "text": "El dueño me dio las llaves y un casco, pero no me explicó nada sobre el tráfico.", "translation": "The owner gave me the keys and a helmet, but he didn't explain anything about the traffic."}, {"type": "sentence", "text": "Salí a la carretera y empecé a conducir por la derecha, como en mi país.", "translation": "I went out onto the road and started driving on the right, like in my country.", "highlights": [{"startIndex": 44, "endIndex": 54, "text": "la derecha", "glossaryKey": "derecha"}]}, {"type": "sentence", "text": "Nadie me dijo que en Indonesia se conduce por la izquierda.", "translation": "Nobody told me that in Indonesia you drive on the left."}, {"type": "sentence", "text": "Los primeros días todo parecía normal.", "translation": "The first few days everything seemed normal."}, {"type": "image", "filename": "bali_scooter_street_traffic.png", "generation_prompt": "Busy street in Bali with scooters and cars, tropical setting, local drivers, slight chaos but colorful and lively."}, {"type": "sentence", "text": "Iba al surf por la mañana y volvía por la tarde.", "translation": "I used to go surfing in the morning and come back in the afternoon."}, {"type": "sentence", "text": "A veces me sentía un poco raro cuando los coches me adelantaban.", "translation": "Sometimes I felt a bit strange when cars overtook me.", "highlights": [{"startIndex": 52, "endIndex": 63, "text": "adelantaban", "glossaryKey": "adelantar"}]}, {"type": "sentence", "text": "Pensaba que los conductores en Bali eran muy atrevidos.", "translation": "I thought the drivers in Bali were very bold."}, {"type": "sentence", "text": "Un día un turista me gritó desde su coche: \"¡Estás en el lado equivocado!\"", "translation": "One day a tourist shouted at me from his car: \"You're on the wrong side!\""}, {"type": "sentence", "text": "No entendí bien y seguí mi camino.", "translation": "I didn't understand well and continued on my way."}, {"type": "sentence", "text": "Al tercer día, otra persona me hizo señas para que me cambiara de carril.", "translation": "On the third day, another person waved at me to change lanes.", "highlights": [{"startIndex": 36, "endIndex": 41, "text": "señas", "glossaryKey": "señas"}]}, {"type": "sentence", "text": "Entonces lo busqué en internet y descubrí la verdad.", "translation": "Then I looked it up on the internet and discovered the truth.", "highlights": [{"startIndex": 33, "endIndex": 41, "text": "descubrí", "glossaryKey": "descubrir"}]}, {"type": "image", "filename": "bali_scooter_surfer_realization.png", "generation_prompt": "Surfer sitting on a scooter at the side of a road, looking at phone with surprised expression, palm trees, Bali, comic relief mood."}, {"type": "sentence", "text": "En Indonesia se conduce por la izquierda, igual que en Reino Unido o Japón.", "translation": "In Indonesia you drive on the left, just like in the UK or Japan."}, {"type": "sentence", "text": "Yo había estado conduciendo por el lado equivocado durante tres días.", "translation": "I had been driving on the wrong side for three days."}, {"type": "sentence", "text": "Menos mal que no pasó nada grave.", "translation": "Thank goodness nothing serious happened."}, {"type": "sentence", "text": "Desde entonces siempre pregunto por las normas de circulación cuando viajo.", "translation": "Since then I always ask about the traffic rules when I travel."}], "glossary": {"medio de transporte": {"translation": "means of transport", "explanation": "Phrase: 'medio' is masculine; use 'un' (a) or 'el' (the). Plural: medios de transporte."}, "alquilar": {"translation": "to rent", "explanation": "Regular -ar verb. Past: alquilé (I rented). Same as 'rentar' in some regions."}, "derecha": {"translation": "right (side)", "explanation": "Noun (la derecha). 'Por la derecha' = on the right. Opposite: la izquierda (left)."}, "izquierda": {"translation": "left (side)", "explanation": "Noun (la izquierda). 'Por la izquierda' = on the left. In Indonesia they drive on the left."}, "adelantar": {"translation": "to overtake, pass", "explanation": "Regular -ar verb. 'Me adelantaban' = they were overtaking me (imperfect, repeated action)."}, "señas": {"translation": "signs, gestures", "explanation": "Plural of 'seña'. 'Hacer señas' = to wave or gesture (at someone)."}, "descubrir": {"translation": "to discover, find out", "explanation": "Regular -ir verb. Past: descubrí. Similar to 'enterarse' (to find out)."}}}};</script>
  <script>
    (function () {
      function getQuery() {
        var q = {};
        (window.location.search || '').replace(/^\?/, '').split('&').forEach(function (p) {
          var kv = p.split('=');
          if (kv.length === 2) q[decodeURIComponent(kv[0])] = decodeURIComponent(kv[1]);
        });
        return q;
      }
      function escapeHtml(s) {
        if (s == null) return '';
        var div = document.createElement('div');
        div.textContent = s;
        return div.innerHTML;
      }
      var name = getQuery().name;
      var story = name && EMBEDDED_STORIES[name];
      if (!story) {
        document.getElementById('content').innerHTML = '<p class="error">Story not found. <a href="index.html">Back to stories</a></p>';
        document.querySelector('header').style.display = 'none';
        return;
      }
      document.title = story.title + ' — Spanish Stories';
      document.getElementById('title').textContent = story.title;
      document.getElementById('meta').textContent = story.level + ' · ' + (story.language || 'es') + (story.titleTranslation ? ' — ' + story.titleTranslation : '');
      var tagsHtml = '';
      if (story.tags && story.tags.length) {
        story.tags.forEach(function (t) {
          tagsHtml += '<span class="tag"><strong>' + escapeHtml(t.name) + '</strong> ' + escapeHtml(t.description) + '</span>';
        });
      }
      document.getElementById('tags').innerHTML = tagsHtml || '—';
      var content = document.getElementById('content');
      var showTranslations = document.getElementById('showTranslations');
      function renderContent() {
        var show = showTranslations.checked;
        content.innerHTML = '';
        story.content.forEach(function (item) {
          if (item.type === 'sentence') {
            var block = document.createElement('div');
            block.className = 'sentence-block' + (show ? ' show-translation' : '');
            var text = item.text;
            if (item.highlights && item.highlights.length) {
              var parts = [];
              var last = 0;
              item.highlights.slice().sort(function (a, b) { return a.startIndex - b.startIndex; }).forEach(function (h) {
                if (h.startIndex > last) parts.push({ type: 'plain', s: text.slice(last, h.startIndex) });
                parts.push({ type: 'hl', s: text.slice(h.startIndex, h.endIndex) });
                last = h.endIndex;
              });
              if (last < text.length) parts.push({ type: 'plain', s: text.slice(last) });
              var span = document.createElement('span');
              span.className = 'text';
              parts.forEach(function (p) {
                if (p.type === 'hl') {
                  var hl = document.createElement('span');
                  hl.className = 'hl';
                  hl.textContent = p.s;
                  span.appendChild(hl);
                } else { span.appendChild(document.createTextNode(p.s)); }
              });
              block.appendChild(span);
            } else {
              var span = document.createElement('span');
              span.className = 'text';
              span.textContent = text;
              block.appendChild(span);
            }
            var trans = document.createElement('div');
            trans.className = 'translation';
            trans.textContent = item.translation || '';
            block.appendChild(trans);
            content.appendChild(block);
          } else if (item.type === 'image') {
            var img = document.createElement('img');
            img.alt = item.generation_prompt || item.filename;
            img.loading = 'lazy';
            img.onerror = function () { this.classList.add('hide'); };
            img.src = 'images/' + item.filename;
            content.appendChild(img);
          }
        });
      }
      showTranslations.addEventListener('change', renderContent);
      renderContent();
      var darkToggle = document.getElementById('darkToggle');
      var iconSun = document.getElementById('iconSun');
      var iconMoon = document.getElementById('iconMoon');
      try {
        if (localStorage.getItem('darkMode') === '1') {
          document.body.classList.add('dark');
          iconSun.style.display = 'none';
          iconMoon.style.display = 'block';
        } else { iconMoon.style.display = 'none'; }
      } catch (e) {}
      darkToggle.addEventListener('click', function () {
        document.body.classList.toggle('dark');
        var isDark = document.body.classList.contains('dark');
        iconSun.style.display = isDark ? 'none' : 'block';
        iconMoon.style.display = isDark ? 'block' : 'none';
        try { localStorage.setItem('darkMode', isDark ? '1' : '0'); } catch (e) {}
      });
      if (story.glossary && Object.keys(story.glossary).length) {
        var gEl = document.getElementById('glossary');
        var gHtml = '<h2>Glossary</h2><dl>';
        Object.keys(story.glossary).forEach(function (key) {
          var e = story.glossary[key];
          gHtml += '<dt>' + escapeHtml(key) + ' — ' + escapeHtml(e.translation) + '</dt><dd>' + escapeHtml(e.explanation) + '</dd>';
        });
        gEl.innerHTML = gHtml + '</dl>';
      }
    })();
  </script>
</body>
</html>
